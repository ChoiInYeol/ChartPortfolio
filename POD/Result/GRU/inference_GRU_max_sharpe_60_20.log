Configuration: {'START': '2001-01-01', 'END': '2024-08-01', 'LEN_DATA': 5000, 'N_STOCK': 313, 'N_SELECT': 50, 'TRAIN_LEN': 60, 'PRED_LEN': 20, 'TRAIN_START_DATE': '2001-01-01', 'TRAIN_END_DATE': '2017-12-31', 'TRAIN_RATIO': 0.7, 'VALIDATION_RATIO': 0.3, 'TEST_START_DATE': '2018-01-01', 'TEST_END_DATE': '2024-08-01', 'RESULT_DIR': 'Result', 'MODEL': 'GRU', 'BATCH': 128, 'EPOCHS': 500, 'EARLY_STOP': 50, 'LR': 0.001, 'MOMENTUM': 0.9, 'USE_CUDA': True, 'SEED': 42, 'LB': 0, 'UB': 0.5, 'LOSS_FUNCTION': 'max_sharpe', 'N_LAYER': 1, 'HIDDEN_DIM': 128, 'N_HEAD': 10, 'N_FEAT': 313, 'DROPOUT': 0.3, 'BIDIRECTIONAL': False, 'TCN': {'n_timestep': 60, 'n_output': 313, 'kernel_size': 4, 'n_dropout': 0.1, 'hidden_size': 64, 'level': 3}, 'TRANSFORMER': {'n_timestep': 60, 'n_output': 313, 'n_layer': 6, 'n_head': 5, 'n_dropout': 0.1}}
Model Path: Result/GRU
Checking file: True_GRU_50_2_loss_-0.1564.pth
Parsed values - use_prob: True, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file True_GRU_50_2_loss_-0.1564.pth: could not convert string to float: ''
Checking file: True_GRU_50_6_loss_-0.1624.pth
Parsed values - use_prob: True, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file True_GRU_50_6_loss_-0.1624.pth: could not convert string to float: ''
Checking file: False_GRU_50_1_loss_-0.2139.pth
Parsed values - use_prob: False, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file False_GRU_50_1_loss_-0.2139.pth: could not convert string to float: ''
Checking file: False_GRU_50_0_loss_-0.2122.pth
Parsed values - use_prob: False, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file False_GRU_50_0_loss_-0.2122.pth: could not convert string to float: ''
Checking file: True_GRU_50_0_loss_-0.1390.pth
Parsed values - use_prob: True, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file True_GRU_50_0_loss_-0.1390.pth: could not convert string to float: ''
Checking file: False_GRU_50_5_loss_-0.2278.pth
Parsed values - use_prob: False, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file False_GRU_50_5_loss_-0.2278.pth: could not convert string to float: ''
Checking file: True_GRU_50_8_loss_-0.1981.pth
Parsed values - use_prob: True, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file True_GRU_50_8_loss_-0.1981.pth: could not convert string to float: ''
Checking file: True_GRU_50_10_loss_-0.2380.pth
Parsed values - use_prob: True, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file True_GRU_50_10_loss_-0.2380.pth: could not convert string to float: ''
Checking file: True_GRU_50_1_loss_-0.1463.pth
Parsed values - use_prob: True, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file True_GRU_50_1_loss_-0.1463.pth: could not convert string to float: ''
Checking file: False_GRU_50_4_loss_-0.2169.pth
Parsed values - use_prob: False, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file False_GRU_50_4_loss_-0.2169.pth: could not convert string to float: ''
Checking file: True_GRU_50_7_loss_-0.1821.pth
Parsed values - use_prob: True, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file True_GRU_50_7_loss_-0.1821.pth: could not convert string to float: ''
Checking file: True_GRU_50_5_loss_-0.1613.pth
Parsed values - use_prob: True, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file True_GRU_50_5_loss_-0.1613.pth: could not convert string to float: ''
Checking file: True_GRU_50_9_loss_-0.2027.pth
Parsed values - use_prob: True, model_type: GRU, n_select: 50
Current config - use_prob: True, model_type: GRU, n_select: 50
Skipping invalid model file True_GRU_50_9_loss_-0.2027.pth: could not convert string to float: ''
Current configuration:
- Model type: GRU
- N_SELECT: 50
- use_prob: True
Available model files:
- True_GRU_50_2_loss_-0.1564.pth
  use_prob: True
  model: GRU
  n_select: 50
- True_GRU_50_6_loss_-0.1624.pth
  use_prob: True
  model: GRU
  n_select: 50
- False_GRU_50_1_loss_-0.2139.pth
  use_prob: False
  model: GRU
  n_select: 50
- False_GRU_50_0_loss_-0.2122.pth
  use_prob: False
  model: GRU
  n_select: 50
- True_GRU_50_0_loss_-0.1390.pth
  use_prob: True
  model: GRU
  n_select: 50
- False_GRU_50_5_loss_-0.2278.pth
  use_prob: False
  model: GRU
  n_select: 50
- True_GRU_50_8_loss_-0.1981.pth
  use_prob: True
  model: GRU
  n_select: 50
- True_GRU_50_10_loss_-0.2380.pth
  use_prob: True
  model: GRU
  n_select: 50
- True_GRU_50_1_loss_-0.1463.pth
  use_prob: True
  model: GRU
  n_select: 50
- False_GRU_50_4_loss_-0.2169.pth
  use_prob: False
  model: GRU
  n_select: 50
- True_GRU_50_7_loss_-0.1821.pth
  use_prob: True
  model: GRU
  n_select: 50
- True_GRU_50_5_loss_-0.1613.pth
  use_prob: True
  model: GRU
  n_select: 50
- True_GRU_50_9_loss_-0.2027.pth
  use_prob: True
  model: GRU
  n_select: 50
Configuration: {'START': '2001-01-01', 'END': '2024-08-01', 'LEN_DATA': 5000, 'N_STOCK': 313, 'N_SELECT': 50, 'TRAIN_LEN': 60, 'PRED_LEN': 20, 'TRAIN_START_DATE': '2001-01-01', 'TRAIN_END_DATE': '2017-12-31', 'TRAIN_RATIO': 0.7, 'VALIDATION_RATIO': 0.3, 'TEST_START_DATE': '2018-01-01', 'TEST_END_DATE': '2024-08-01', 'RESULT_DIR': 'Result', 'MODEL': 'GRU', 'BATCH': 128, 'EPOCHS': 500, 'EARLY_STOP': 50, 'LR': 0.001, 'MOMENTUM': 0.9, 'USE_CUDA': True, 'SEED': 42, 'LB': 0, 'UB': 0.5, 'LOSS_FUNCTION': 'max_sharpe', 'N_LAYER': 1, 'HIDDEN_DIM': 128, 'N_HEAD': 10, 'N_FEAT': 313, 'DROPOUT': 0.3, 'BIDIRECTIONAL': False, 'TCN': {'n_timestep': 60, 'n_output': 313, 'kernel_size': 4, 'n_dropout': 0.1, 'hidden_size': 64, 'level': 3}, 'TRANSFORMER': {'n_timestep': 60, 'n_output': 313, 'n_layer': 6, 'n_head': 5, 'n_dropout': 0.1}}
Model Path: Result/GRU
Checking file: True_GRU_50_2_loss_-0.1564.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1564
Found matching model: True_GRU_50_2_loss_-0.1564.pth
Checking file: True_GRU_50_6_loss_-0.1624.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1624
Found matching model: True_GRU_50_6_loss_-0.1624.pth
Checking file: False_GRU_50_1_loss_-0.2139.pth
Parsed - use_prob: False, model: GRU, n_select: 50, loss: -0.2139
Checking file: False_GRU_50_0_loss_-0.2122.pth
Parsed - use_prob: False, model: GRU, n_select: 50, loss: -0.2122
Checking file: True_GRU_50_0_loss_-0.1390.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.139
Found matching model: True_GRU_50_0_loss_-0.1390.pth
Checking file: False_GRU_50_5_loss_-0.2278.pth
Parsed - use_prob: False, model: GRU, n_select: 50, loss: -0.2278
Checking file: True_GRU_50_8_loss_-0.1981.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1981
Found matching model: True_GRU_50_8_loss_-0.1981.pth
Checking file: True_GRU_50_10_loss_-0.2380.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.238
Found matching model: True_GRU_50_10_loss_-0.2380.pth
Checking file: True_GRU_50_1_loss_-0.1463.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1463
Found matching model: True_GRU_50_1_loss_-0.1463.pth
Checking file: False_GRU_50_4_loss_-0.2169.pth
Parsed - use_prob: False, model: GRU, n_select: 50, loss: -0.2169
Checking file: True_GRU_50_7_loss_-0.1821.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1821
Found matching model: True_GRU_50_7_loss_-0.1821.pth
Checking file: True_GRU_50_5_loss_-0.1613.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1613
Found matching model: True_GRU_50_5_loss_-0.1613.pth
Checking file: True_GRU_50_9_loss_-0.2027.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.2027
Found matching model: True_GRU_50_9_loss_-0.2027.pth
Selected best model: True_GRU_50_10_loss_-0.2380.pth
Model loss: -0.2380
Selected best model: True_GRU_50_10_loss_-0.2380.pth
Model loss: -0.2380
Model loaded from: Result/GRU/True_GRU_50_10_loss_-0.2380.pth
Loading test data...
Error during inference: too many indices for tensor of dimension 2
Configuration: {'START': '2001-01-01', 'END': '2024-08-01', 'LEN_DATA': 5000, 'N_STOCK': 313, 'N_SELECT': 50, 'TRAIN_LEN': 60, 'PRED_LEN': 20, 'TRAIN_START_DATE': '2001-01-01', 'TRAIN_END_DATE': '2017-12-31', 'TRAIN_RATIO': 0.7, 'VALIDATION_RATIO': 0.3, 'TEST_START_DATE': '2018-01-01', 'TEST_END_DATE': '2024-08-01', 'RESULT_DIR': 'Result', 'MODEL': 'GRU', 'BATCH': 128, 'EPOCHS': 500, 'EARLY_STOP': 50, 'LR': 0.001, 'MOMENTUM': 0.9, 'USE_CUDA': True, 'SEED': 42, 'LB': 0, 'UB': 0.5, 'LOSS_FUNCTION': 'max_sharpe', 'N_LAYER': 1, 'HIDDEN_DIM': 128, 'N_HEAD': 10, 'N_FEAT': 313, 'DROPOUT': 0.3, 'BIDIRECTIONAL': False, 'TCN': {'n_timestep': 60, 'n_output': 313, 'kernel_size': 4, 'n_dropout': 0.1, 'hidden_size': 64, 'level': 3}, 'TRANSFORMER': {'n_timestep': 60, 'n_output': 313, 'n_layer': 6, 'n_head': 5, 'n_dropout': 0.1}}
Model Path: Result/GRU
Checking file: True_GRU_50_2_loss_-0.1564.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1564
Found matching model: True_GRU_50_2_loss_-0.1564.pth
Checking file: True_GRU_50_6_loss_-0.1624.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1624
Found matching model: True_GRU_50_6_loss_-0.1624.pth
Checking file: False_GRU_50_1_loss_-0.2139.pth
Parsed - use_prob: False, model: GRU, n_select: 50, loss: -0.2139
Checking file: False_GRU_50_0_loss_-0.2122.pth
Parsed - use_prob: False, model: GRU, n_select: 50, loss: -0.2122
Checking file: True_GRU_50_0_loss_-0.1390.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.139
Found matching model: True_GRU_50_0_loss_-0.1390.pth
Checking file: False_GRU_50_5_loss_-0.2278.pth
Parsed - use_prob: False, model: GRU, n_select: 50, loss: -0.2278
Checking file: True_GRU_50_8_loss_-0.1981.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1981
Found matching model: True_GRU_50_8_loss_-0.1981.pth
Checking file: True_GRU_50_10_loss_-0.2380.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.238
Found matching model: True_GRU_50_10_loss_-0.2380.pth
Checking file: True_GRU_50_1_loss_-0.1463.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1463
Found matching model: True_GRU_50_1_loss_-0.1463.pth
Checking file: False_GRU_50_4_loss_-0.2169.pth
Parsed - use_prob: False, model: GRU, n_select: 50, loss: -0.2169
Checking file: True_GRU_50_7_loss_-0.1821.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1821
Found matching model: True_GRU_50_7_loss_-0.1821.pth
Checking file: True_GRU_50_5_loss_-0.1613.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.1613
Found matching model: True_GRU_50_5_loss_-0.1613.pth
Checking file: True_GRU_50_9_loss_-0.2027.pth
Parsed - use_prob: True, model: GRU, n_select: 50, loss: -0.2027
Found matching model: True_GRU_50_9_loss_-0.2027.pth
Selected best model: True_GRU_50_10_loss_-0.2380.pth
Model loss: -0.2380
Selected best model: True_GRU_50_10_loss_-0.2380.pth
Model loss: -0.2380
Model loaded from: Result/GRU/True_GRU_50_10_loss_-0.2380.pth
Loading test data...
Test data loaded: 1577 samples
Test data shape: x=(1577, 60, 313)
Test prob shape: prob=(1577, 313)
Input shapes - x: torch.Size([1, 60, 313]), prob: torch.Size([1, 313])
Error during inference: too many indices for tensor of dimension 2
Traceback: Traceback (most recent call last):
  File "/home/indi/codespace/Portfolio-Optimization-Deep-Learning-WIth-Candlestick-Image/POD/inference.py", line 267, in infer
    outputs = self.model(x, prob)
              ^^^^^^^^^^^^^^^^^^^
  File "/home/indi/anaconda3/envs/imagedpo2/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/indi/anaconda3/envs/imagedpo2/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/indi/codespace/Portfolio-Optimization-Deep-Learning-WIth-Candlestick-Image/POD/model/gru.py", line 170, in forward
    h_probs = self.prob_encoder(x_probs[:, 0, :])
                                ~~~~~~~^^^^^^^^^
IndexError: too many indices for tensor of dimension 2

Empty weights array received
Weights array shape: (0,)
Configuration: {'START': '2001-01-01', 'END': '2024-08-01', 'LEN_DATA': 5000, 'N_STOCK': 313, 'N_SELECT': 50, 'TRAIN_LEN': 60, 'PRED_LEN': 20, 'TRAIN_START_DATE': '2001-01-01', 'TRAIN_END_DATE': '2017-12-31', 'TRAIN_RATIO': 0.7, 'VALIDATION_RATIO': 0.3, 'TEST_START_DATE': '2018-01-01', 'TEST_END_DATE': '2024-08-01', 'RESULT_DIR': 'Result', 'MODEL': 'GRU', 'BATCH': 128, 'EPOCHS': 500, 'EARLY_STOP': 50, 'LR': 0.001, 'MOMENTUM': 0.9, 'USE_CUDA': True, 'SEED': 42, 'LB': 0, 'UB': 0.5, 'LOSS_FUNCTION': 'max_sharpe', 'N_LAYER': 1, 'HIDDEN_DIM': 128, 'N_HEAD': 10, 'N_FEAT': 313, 'DROPOUT': 0.3, 'BIDIRECTIONAL': False, 'TCN': {'n_timestep': 60, 'n_output': 313, 'kernel_size': 4, 'n_dropout': 0.1, 'hidden_size': 64, 'level': 3}, 'TRANSFORMER': {'n_timestep': 60, 'n_output': 313, 'n_layer': 6, 'n_head': 5, 'n_dropout': 0.1}}
Model Path: Result/GRU
Loading model: True_GRU_50_10_loss_-0.2380.pth
Loading test data...
Test data loaded: 1577 samples
Loaded 313 tickers
Created date index with 1577 dates
Weights array shape: (1577, 313)
Expected shape: (1577, 313)
Weights saved to Result/GRU/weights_True_GRU_n50_t60_p20_loss-0.1564.csv
Model parameters:
- Use prob: True
- Model: GRU
- N_select: 50
- Train length: 60
- Pred length: 20
- Model loss: -0.1564
